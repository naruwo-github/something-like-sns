syntax = "proto3";
package sns.v1;
option go_package = "github.com/example/something-like-sns/apps/api/gen/sns/v1;v1";
import "sns/v1/timeline.proto";

message Conversation { uint64 id = 1; string created_at = 2; repeated uint64 member_user_ids = 3; }
message Message { uint64 id = 1; uint64 conversation_id = 2; uint64 sender_user_id = 3; string body = 4; string created_at = 5; }

message GetOrCreateDMRequest { uint64 other_user_id = 1; }
message GetOrCreateDMResponse { uint64 conversation_id = 1; }
message ListConversationsRequest { Cursor cursor = 1; }
message ListConversationsResponse { repeated Conversation items = 1; Cursor next = 2; }
message ListMessagesRequest { uint64 conversation_id = 1; Cursor cursor = 2; }
message ListMessagesResponse { repeated Message items = 1; Cursor next = 2; }
message SendMessageRequest { uint64 conversation_id = 1; string body = 2; }
message SendMessageResponse { Message message = 1; }

service DMService {
  rpc GetOrCreateDM(GetOrCreateDMRequest) returns (GetOrCreateDMResponse);
  rpc ListConversations(ListConversationsRequest) returns (ListConversationsResponse);
  rpc ListMessages(ListMessagesRequest) returns (ListMessagesResponse);
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
}
